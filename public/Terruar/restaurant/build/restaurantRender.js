function p(e){let i=e.split("/").slice(0,-1).join("/").replace("static","thumb"),n=e.split("/").pop();return`${i}/-/format/webp/${n}.webp`}async function d(){let i;try{i=await(await fetch("https://store.tildaapi.com/api/getproductslist/?storepartuid=513452425241&recid=752306605&c=1716436482010&getparts=true&getoptions=true&slice=1&size=36&projectid=5131025")).json()}catch(t){return[]}let n=i.parts.sort((t,l)=>t.sort-l.sort).map((t)=>({uid:t.uid,title:t.title,sort:t.sort,products:[]}));return i.products.forEach((t)=>{let l={title:t.title||"",descr:t.descr||"",price:parseFloat(t.price)||0,photoList:(()=>{try{let o=JSON.parse(t.gallery||"[]");return Array.isArray(o)?o.map((r)=>p(r.img)):[]}catch{return[]}})(),category:(()=>{let o=JSON.parse(t.partuids||"[]"),r=i.parts.find((m)=>o.includes(m.uid));return r?r.title:"Неизвестная категория"})(),weight:t.pack_m||void 0,specs:(()=>{if(!t.characteristics||!Array.isArray(t.characteristics))return;return t.characteristics.reduce((o,r)=>{return o[r.title]=r.value,o},{})})()},s=JSON.parse(t.partuids||"[]"),a=n.find((o)=>s.includes(o.uid));if(a)a.products.push(l)}),console.log("Категории с продуктами:",n),n}class c{title;initialContent;container;contentElement;headerElement;titleElement;closeButton;isOpen=!1;constructor(e,i){this.title=e;this.initialContent=i;this.container=document.createElement("div"),this.container.classList.add("pop-up"),this.contentElement=document.createElement("div"),this.contentElement=i,this.contentElement.classList.add("pop-up-content"),this.headerElement=document.createElement("div"),this.headerElement.className="pop-up-header",this.closeButton=document.createElement("button"),this.closeButton.textContent="Закрыть",this.titleElement=document.createElement("p"),this.titleElement.className="pop-up-title",this.titleElement.textContent=this.title,this.headerElement.appendChild(this.titleElement),this.headerElement.appendChild(this.closeButton),this.container.appendChild(this.headerElement),this.container.appendChild(this.contentElement),this.closeButton.addEventListener("click",()=>this.close()),this.container.addEventListener("click",(n)=>{if(n.target===this.container)this.close()})}open(){if(document.addEventListener("keydown",this.handleKeyDown),!this.isOpen)document.body.appendChild(this.container),this.isOpen=!0}close(){if(document.removeEventListener("keydown",this.handleKeyDown),this.isOpen)document.body.removeChild(this.container),this.isOpen=!1}setTitle(e){this.title=e,this.titleElement.textContent=e}setContent(e){this.contentElement.replaceWith(e),this.contentElement=e}handleKeyDown=(e)=>{if(e.key==="Escape"&&this.isOpen)this.close()}}var h='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12c0 1.379.28 2.693.784 3.888c.279.66.418.99.436 1.24c.017.25-.057.524-.204 1.073L2 22l3.799-1.016c.549-.147.823-.22 1.073-.204c.25.018.58.157 1.24.436A10 10 0 0 0 12 22"/><path d="m8.588 12.377l.871-1.081c.367-.456.82-.88.857-1.488c.008-.153-.1-.841-.315-2.218C9.916 7.049 9.41 7 8.973 7c-.57 0-.855 0-1.138.13c-.358.163-.725.622-.806 1.007c-.064.305-.016.515.079.935c.402 1.783 1.347 3.544 2.811 5.009c1.465 1.464 3.226 2.409 5.01 2.811c.42.095.629.143.934.079c.385-.08.844-.448 1.008-.806c.129-.283.129-.568.129-1.138c0-.438-.049-.943-.59-1.028c-1.377-.216-2.065-.323-2.218-.315c-.607.036-1.032.49-1.488.857l-1.081.87"/></g></svg>';function u(e,i){let n=document.createElement("div");return n.className="product",n.style.animationDelay=`${i*0.05}s`,n.innerHTML=`
    <div class="product-header">
      <img src="${e.photoList[0]}" 
        loading="lazy" referrerpolicy="no-referrer"
        alt="${e.title}"
        crossorigin="anonymous" />
    </div>
    <div class="product-info">
      <p class="product-title"> ${e.title} </p>
      <p class="product-descr"> ${e.descr} </p>
    </div>
    <div class="product-footer">
      <a href="https://wa.me/79670655655?text=Здравствуйте! Я хочу заказать ${e.title}" target="_blank" rel="noopener noreferrer"> 
        <span>Заказать</span> ${h}</a>
      <p class="product-price"> ${e.price} ₽ </p>
    </div>
  `,n}async function v(){let e=document.createElement("div");return e.classList.add("catalogue"),(await d()).forEach((n)=>{if(n.products.length===0)return;let t=document.createElement("div");t.classList.add("category");let l=document.createElement("div");l.textContent=n.title,l.classList.add("cat-title"),t.appendChild(l),console.log(n),n.products.forEach((s,a)=>{let o=u(s,a);t.appendChild(o)}),e.appendChild(t)}),e}async function y(){let e=await v(),i=new c("Готовая еда в глэмпинге",e),t=new URLSearchParams(location.search).has("open-rest"),l=document.querySelectorAll('[data-action="open-restaurant-menu"]');if(l.length)l.forEach((s)=>{s.addEventListener("click",()=>i.open())});if(t)i.open()}window.addEventListener("load",y);
